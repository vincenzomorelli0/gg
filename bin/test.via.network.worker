#!/usr/bin/env sh
set -e
startTime=$(date +%s)
networkProjectFolder=$(pwd)
echo 'Some logs of the build are located at `../net.splitcells.network.log/target`.'
cd ../net.splitcells.network.bom
    mvn clean install
    cd ../net.splitcells.network
logFolder=../net.splitcells.network.log/src/main/csv/net/splitcells/network/worker/builder/warnings/
logFile=$logFolder/$(hostname).csv
test -d ../net.splitcells.network.log/target || mkdir ../net.splitcells.network.log/target
    test -f ../net.splitcells.network.log/target/test.via.network.worker.log && rm ../net.splitcells.network.log/target/test.via.network.worker.log
    mvn clean install -DskipTests > ../net.splitcells.network.log/target/test.via.network.worker.log
    numberOfWarnings=$(cat ../net.splitcells.network.log/target/test.via.network.worker.log | grep --ignore-case warning | wc -l)
mkdir -p $logFolder
test -f $logFile || echo 'Date,Number Of Warnings' >> $logFile
echo $(date +'%Y-%m-%d')','$numberOfWarnings >> $logFile
cd ../net.splitcells.network.log
    repo.commit.all
    cd ../net.splitcells.network
cd projects/net.splitcells.system
bin/execute | echo.error '`net.splitcells.system/bin/execute` was not successful.'
endTime=$(date +%s)
completionRuntimeFolder=$networkProjectFolder/../net.splitcells.network.log/src/main/csv/net/splitcells/network/worker/builder/runtime/complete/
mkdir -p "$completionRuntimeFolder"
echo runTime=$(($endTime - startTime)) >> "$completionRuntimeFolder/$(hostname).csv"
cd ../../../net.splitcells.network.log
    # Normally this is done via the Java code in 'bin/execute'.
    # Under some conditions this does not work, because git cannot find the 'user.name' or 'user.email' config.
    repo.commit.all